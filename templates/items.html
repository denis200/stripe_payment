{% extends 'index.html' %}

{%block content%}

{% for object in object_list %}
<div >
    <a href="{% url 'item' pk=object.pk %}">
    <h2>{{object.name}}</h2></a>
    <p>{{object.description}}</p>
    <p>{{object.price}}</p>
    <input class="chkItem" type="checkbox" id="{{object.id}}"> 
    
</div>




{% endfor %}
<button id="buy-button">Buy</button>

<script src="https://js.stripe.com/v3/"></script>
<script type="text/javascript">
    var buyButton = document.getElementById('buy-button');
    
    buyButton.addEventListener('click', function() {
      // Create a new Checkout Session using the server-side endpoint 
      // Redirect to Stripe Session Checkout
      var inp = document.getElementsByTagName('input');
      var length = inp.length;
      var mas = [];

      for (var i = 0; i < length; i++) {
            if (inp[i].checked == true){
            mas.push(parseInt(inp[i].id));
        }
          }
        
          fetch('http://127.0.0.1:8000/buy/1', {method: 'GET'})
          .then(response =>{ return response.json()})
          .then(res => stripe.redirectToCheckout({ sessionId: res.session_id }))
     console.log(mas)
      
    });
  </script>
  
  {%endblock%}